**思路：**
- 实现新建图形对象，将每一个对象都在canvas上绘制好，默认隐藏；

- 自定义一个图形基类，用于自定义图形的基本属性及方法；
带箭头的图形实际可以继承不带箭头的同类图形的isDrawObjSel方法判断是否选中；

- 绘制图形时，只要将图形的坐标点计算正确即可，画布起定时器重绘；

**难点：**
- 如何判断鼠标是否选中了该图形；
需要在图形周围绘制一个透明的矩形，利用isPointInPath判断鼠标点是否在矩形内

- 绘制带箭头的图形，箭头的画法；
要考虑移动中心和记录旋转角，并保存和还原之前的上下文

- 绘制多边形判断箭头方向的绘制；
根据前两点的中心位置选择接近的任意一点是否在图形内（因为绘制箭头是在前两点的中心位置）决定如何绘制箭头

- 选中图形时会出现锚点，重绘时锚点要保存在画布对象中；
在画布对象中新建属性anchorList保存
        
- 绘制客流量线段的游标时，需要考虑游标绘制边界条件的处理；
---
1. 为每一种图形类型创建一个类，属性中定义图形序号，图形的文字，图形类型，图形是否显示，图形边框，图形坐标信息，带箭头图形的箭头方向，多边形是否正在重绘，多边形坐标点的数量，只能移动矩形的图形填充，客流量线段的游标（是否显示游标，选中的游标，游标颜色）等。

2. 原型中定义每种类型图片的方法：  
 
**createDrawObj(context)**：绘制图形（包括绘制文字) 

每次绘制图形前后形式如：  
```
// 遇到translate或rotate移动原点，旋转时，先执行save
context.save(); 
context.beginPath();
......
context.stroke();
context.closePath();
// 遇到translate或rotate移动原点，save后执行restore还原
context.restore(); 
```

**isDrawObjSel(context, x, y)**：判断鼠标位置是否在绘制图形内

由于绘制图形太细不好选中，判断时在绘制图形外包一层多5像素距离的矩形，判断鼠标位置是否在矩形内：
```
// 利用context.isPointInPath(x, y) 绘制矩形时判断该点是否在
// 矩形内，以判断是否选中了该矩形
context.save();
context.beginPath();
.....
context.stroke();
context.closePath();
context.restore();
```
绘制客流量线段除需判断是否在线段上之外，还要判断是否在游标上：
```
// 若在游标上，则设置客流量线段的游标属性
this.bSelVernier = true;  // 游标被选中
this.vernierNum = 2;      // 选中的是num为2的游标
```

3. 初始化画布类DrawObj:

**初始化画布对象的属性**：
①初始化画布对象的canvas，画布的实例化图形对象，画布对应的video，画布锚点坐标，当前拖动的锚点信息，当前选中图形对象，鼠标所在图形对象，鼠标位置等；

②setCanvas:根据video的大小生成画布,为画布绑定鼠标事件，重绘画布图形坐标点事件；

③init:实例化图形对象，存储到drawMap中；

④起定时器进行图形的重绘reDraw，完成移动，拖拽，放大缩小等一系列功能。为每个图形执行createDrawObj;

**画布对象的方法**：
- draw:在空白处进行重绘图形
客流量线段需要判断是否选中游标，改变游标的坐标还是线段的坐标;需对各种游标的边界条件做处理

- updateAnchor：用来更新当前图形界面的锚点信息

- setMouseStyle：根据鼠标位置显示鼠标状态

- getMousePosition：判断鼠标在画布上的位置
是否在锚点上->是否在图形上（先判断后画的）->在空白位置

- moveDrawObj：图形移动事件。保存上一次的坐标位置，更新图形的坐标值

- changeSize：锚点的拖拽，使图形放大缩小
同心矩形需要考虑边界条件；客流量线段需要计算游标的位置
......

5. canvas上绑定的事件解析：

**doMousemove**:鼠标移动事件：
- 鼠标先按下的状态：

- 鼠标还未按下的状态：
当前选中图形正在绘制(特指多边形)：执行draw在空白处绘制；更新锚点信息updateAnchor；
其他：根据鼠标位置显示鼠标状态setMouseStyle；

**doMouseup**:主要是对正则绘制多边形的绘制
- 多边形多于两个顶点，在顶点0处up可闭合图形；

- 多边形小于6个顶点，不允许落回已有顶点上。已达到6个顶点，再up不生效；

- 在up处触发坐标上报isReport=true;

**doDblclick**:多边形画图可以通过双击来闭合